EC2是AWS主要的Web服务，在云中提供可调整的计算能力。

# Compute Basics

计算是指完成工作量所需的能力。如果您的工作量非常小，例如运行一个访问次数较少的网站，则您的计算能力需求非常小。大工作量的工作，例如针对常见癌症从一千万种化合物中筛选，可能需要海量的计算能力。您需要的计算量可能会随着时间的推移而发生巨大变化。

EC2允许您通过启动被称之为实例的虚拟服务器来获取计算能力。启动实例时，您可以根据需要预计需要的EC2能力，启动相应的服务器，就像使用本地服务器一样。因为您要为实例的计算能力付费，所以在实例运行时按小时收费。实例停止后，您不需要再为此付费。

# Instance Types

实例类型定义EC2实例的虚拟硬件。 有许多可用的实例类型，由以下维度来参与评估

• 虚拟CPU（vCPU）

• 内存

• 存储

• 网络性能

实例类型根据以上这些指标的值之间的比率分组（族）。例如，m4系列提供了计算，内存和网络资源的平衡，对于许多应用程序来说是一个不错的选择。 在每个分组中，EC2实例类型的部分选择可以按比例放大。 图3.1显示了m4系列中的四个实例大小。 请注意，因为线性关系的原因，vCPU与内存的比率是恒定不变的。 每种尺寸的单价也呈线性增长。 例如，m4.xlarge实例的价格是m4.large实例的两倍。

![](/assets/import.png)

直线的斜率代表了实例类型倾向的能力设计，以满足不同类型的工作要求。每个实例系列里，都存在能力线性放大的行为。表3.1列出了一些可用的系列。

为了响应客户需求并利用新的处理器技术，AWS偶尔会引入新的实例系列。请登录AWS网站以获取当前列表。

选择实例类型时要考虑的另一个变量是网络性能。对于大多数实例类型，AWS定义的网络性能指标为：低，中或高。某些实例类型指定10 Gbps的网络性能。随着实例类型的增长，网络性能在一个系列中随之提升。

许多实例类型支持增强型网络来支持需求高网络性能的工作。增强型网络通过启用称为SR-IOV的功能，减少虚拟化对网络性能的影响，获得更高的每秒数据包数（PPS），更低的延迟和更少的抖动。在撰写本文时，有些实例类型支持C3，C4，D2，I2，M4和R3系列中的增强联网（请参阅AWS文档以获取当前列表）。增强型网络仅适用于在Amazon Virtual Private Cloud（Amazon VPC）中启动的实例，第4章“Amazon Virtual Private Cloud（Amazon VPC）”对此进行了讨论。

![](/assets/import2.png)

# Amazon Machine Images \(AMIs\)

AMI定义了实例初始软件，包括：

• 操作系统（OS）及其配置

• 任何补丁的初始状态

• 应用程序或系统软件

所有AMI都基于x86操作系统，Linux或Windows。AMI有四个来源：

• AWS发布——AWS发布了许多不同操作系统的版本，包括Linux和Windows。 这些包括Linux的多个发行版（包括Ubuntu，Red Hat和Amazon自己的发行版）以及Windows 2008和Windows 2012.类似于从ISO印象安装操作系统。 与任何操作系统安装一样，您应该在启动时给系统搭上合适的补丁。

• AWS商店——AWS在线商店提供了合作伙伴开发的软件，客户可在商店上查找，使用软件服务。这有两个好处：客户不需要安装软件，软件许可协议适用于AWS。需要注意的是从在线商店获取的软件服务可能导致额外的费用产生。

• 现行实例——从现有Amazon EC2实例创建AMI。客户配置好适用于自身的实例后，可以此实例生成AMI用于将来创建的实例。

• 上传的虚拟服务——使用AWS VM导入/导出服务，客户可以创建各种文件格式的映像，包括原始格式，VHD，VMDK和OVA。

# Securely Using an Instance

实例启动后，可通过互联网管理。AWS提供了各种功能服务，确保用户简单方便、安全的完成管理工作。

# Addressing an Instance

连接实例有以下几种方式：

公共DNS——启动实例时，AWS会自动为实例创建DNS名称，用户无法指定。公共DNS名可在AWS管理控制台的“描述”选项卡中找到，也可以通过命令行界面（CLI）或应用程序编程接口（API）获取。 公共DNS名称仅在实例运行时保留，并且无法转给另一个实例使用。

公共IP——实例可能已分配公共IP地址。 此IP地址是从AWS保留的地址分配的，无法指定。 在Internet上唯一，且仅在实例运行时保留，无法转给另一个实例使用。

弹性IP——弹性IP地址是Internet上唯一的地址，您可以单独保留并与Amazon EC2实例关联。 弹性IP虽然与公共IP类似，但仍有一些关键性差异。 弹性IP地址一直存在，与实例的状态无关，直到客户将其释放。 因为它可以在实例发生故障时重定向给替换实例，所以它是一个可以外部共享的公共地址，无需将客户端与特定实例绑定。

# Initial Access

EC2使用公钥加密和解密登录信息。使用公钥加密数据和私钥来解密数据，这两个秘钥一起称之为秘钥对。秘钥对可通过AWS管理控制台，CLI和API创建，或者有用户自行上传。AWS上保存公钥，用户保存私钥。私钥对于初次访问实例至关重要。

Windows实例启动时，EC2会为本地管理员帐户生成随机密码，并使用公钥加密，通过在控制台或API中使用私钥解密来获得对实例的初始访问。解密的密码也可用于通过RDP使用本地管理员帐户登录。因此，您可以创建其他本地用户或连接到Active Directory域。

# Virtual Firewall Protection

AWS允许您通过称为安全组的虚拟防火墙控制进出实例的流量。 安全组允许您根据端口，协议和源/目标控制流量。 安全组具有不同的功能，具体取决于它们是与Amazon VPC还是Amazon EC2-Classic相关联。 表3.2比较了这些不同的功能（Amazon VPC将在第4章中讨论）。

安全组在启动时与实例相关联。 每个实例必须配置一个或多个安全组。

安全组默认的行为是拒绝; 也就是说，未经过安全组规则的流量都会被阻挡在外。 规则由三个属性（端口、协议和来源/目标）定义。 当实例与多个安全组关联时，则满足其中一个规则的请求就会被放行。

![](/assets/import3.png)

# The Lifecycle of Instances

EC2提供了多种功能，服务来管理EC2实例的生命周期。

Bootstrapping 云的一大好处是能够编排脚本管理虚拟硬件，这在本地硬件是无法实现的。为了实现这一点，须在启动实例时以编程方式配置实例和安装应用程序。这个在启动时在实例上运行的代码的过程称为bootstrapping。

实例启动时有一个名为UserData的字符型参数。 该字符串将传递给操作系统，以便在第一次引导实例时作为启动过程的一部分执行。 在Linux实例上，可以传递Shell脚本，在Windows实例上，可以传递批处理脚本或PowerShell脚本。 该脚本可以执行以下任务：

• 给操作系统打系统补丁

• 注册目录服务

• 安装应用软件

• 从存储中取出长脚本或程序以在实例上运行

• 安装Chef或Puppet并为实例分配角色让配置软件可以配置实例

VM Import/Export 除了将实例用AMI形式导入外，VM Import / Export还可以让您轻松将虚拟机映像从现有环境导入到 Amazon EC2 实例中，然后再将导出回本地环境。

Instance Metadata 实例元数据是描述实例的数据，可用于配置或管理运行中的实例。实例元数据是一种从OS内获取实例的AWS属性而无需调用AWS API的机制。 例如，调用http://169.254.169.254/latest/meta-data/将返回实例元数据树的顶级节点。实例元数据包含以下要素：

• 实例关联的安全组

• 实例ID

• 实例类型

• 启动实例的AMI

这只是元数据的一点粗浅应用，要了解元数据的详细信息请浏览AWS官方网站。

# Managing Instances

当您帐户中的实例数量开始攀升时，管理、跟踪它们的难度将增大。 标签不仅可以帮助您管理Amazon EC2实例，还可以帮助您管理许多AWS Cloud服务。标签是键值对。您可以用来定位实例或其他服务。 标签可用于标识实例的属性，如项目，环境（开发，测试等）。 每个实例最多可以应用10个标签。

# Monitoring Instances

AWS提供名为Amazon CloudWatch的服务，该服务为Amazon EC2实例以及其他AWS基础架构提供监控和警报功能。 Amazon CloudWatch将在第5章“Elastic Load Balancing，Amazon CloudWatch和Auto Scaling”中详细讨论。

# Modifying an Instance

实例启动后，其部分属性是可以变更的。

Instance Type 变更实例类型能极大提高运行计算的灵活性。它让用户可以选择最合适的实例类型运行，而不是提早几个月就要预计将要使用的硬件配置。如果计算能力超出或达不到需求水平，则可以通过变更实例类型来调整计算能力。可通过控制台，CLI和API来调整实例类型。调整过程需要先将实例停止，变更，然后重新启动。

Security Groups 如果实例在VPC中运行，则可以在实例运行时变更关联的安全组。VPC外的实例启动后，安全组是不能更改的。

# Termination Protection

实例没有存在的必要时，可将其状态设置为Terminated，然后关闭或者删除实例。为防止错误操作，实例启动时可打开“终止保护”选项，该选项打开之后，实例将不能被停用，直到关闭了选项。此选项不能防止OS或者Auto Scaling层面对实例的停用，也不能防止“欠费停机”的机制。



