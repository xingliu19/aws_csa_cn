# 存储桶

存储桶是存储在S3中的对象（文件）的容器（Web文件夹）。 每个S3对象都包含在存储桶中。 存储桶构成Amazon S3的顶级命名空间，存储桶名称是全局的。 这意味着您的存储桶名称在所有AWS账户中必须是唯一的，就像域名系统（DNS）中的域名一样，而不仅仅是在您自己的账户中唯一。 存储桶名称最多可包含63个小写字母，数字，连字符和句点。 您可以创建和使用多个存储桶; 默认情况下，每个帐户最多可以包含100个存储桶。



Tips：给您的存储桶命名包含域名并符合DNS命名规则是最佳实践之一，这样可以确保存储桶名称是您自己的，能在所有区域中使用，并且还能打造成静态网站。



## AWS Regions

尽管S3存储桶的命名空间是全局的，但每个S3存储桶都是在您选择的特定区域中创建。 这意味着您可以控制数据的存储位置。您可以创建和使用位于特定用户附近的存储桶，以最大限度地减少延迟，或者指定区域以满足数据权属问题，您还可以让数据远离主要设施，以满足灾难恢复和合规性需求。 除非您将其明确复制到位于其他区域的另一个存储桶，S3存储桶中的数据将存储在该区域中。



## Objects

对象是存储在S3存储桶中的实体或文件。 对象支持几乎所有类型的数据。 对象的大小可以从0字节到5TB，单个存储桶可以存储无限数量的对象。 这意味着S3可以存储几乎无限量的数据。

每个对象由数据和元数据组成。 对象的数据部分对S3来说是个黑盒子—— 这意味着对象的数据被简单地视为一个字节流 。S3不知道也不关心您存储的数据类型，并且该服务对文本数据与二进制数据的行为不同。

与对象关联的元数据是一组描述对象的键值对。 有两种类型的元数据：系统元数据和用户元数据。 系统元数据由S3本身创建和使用，它包括上次修改日期，对象大小，MD5摘要和HTTP内容类型等内容。 用户元数据是可选的，但只能在创建对象时指定。 您可以使用自定义元数据来定义对您来说有实际意义的属性标记和数据。



## Keys

S3存储桶中的每个对象都拥有一个称为密钥的唯一标识符。 您可以将它视为文件名。 密钥最多可包含1024个字节的Unicode UTF-8字符，包括嵌入的斜杠，反斜杠，点和短划线。密钥在单个存储桶中必须是唯一的，但不同的存储桶可以包含具有相同密钥的对象。因此，bucket，key和版本ID（可选）组合起来才能构成对象的全局唯一标识。



## Object URL

S3存储用于互联网，每个对象都可通过唯一的URL寻址，URL可由web服务端、存储桶名字和对象key组成。例如：http://mybucket.s3.amazonaws.com/jack.doc

在这里，mybucket是S3存储桶名称，jack.doc是密钥或文件名。



## Amazon S3 Operations

S3的程序接口设计精简，只包括：

	• 创建/删除存储桶

	• 写一个对象

	• 读一个对象

	• 删除一个对象

	• 列出存储桶中的密钥



## REST Interface

S3程序接口被设计成REST风格。您可以通过HTTP或HTTPS请求来调用接口实现对存储桶、对象的操作。如读是HTTP GET，删除是HTTP DELETE 等。

一般来说，用户不会直接调用REST接口，而是通过更高级别的封装过的工具或语言来与S3交互。如通过高级语言调用，软件调用，CLI调用等。



## 持久和可用性

持久和可用是两个相关但又不同的概念。持久是为了解决“我的数据将来还会存在吗？”的问题，而可用是为了“我现在可以访问我的数据吗？”的问题。理所当然的，S3旨在为数据存储提供高持久和高可用性。

S3的设计标准是制定年份内保持99.999999999％的持久能力和99.99%的可用性。例如，如果您使用S3存储10,000个对象，可能平均每10,000,000年会丢失一个对象。

S3通过在一个区域内的多个设施中的多个设备上自动冗余的方式存储数据来实现高耐久性。 它旨在保证数据即使在两个设施中一起丢失了，也不会让用户损失数据。 S3提供了一个高度耐用的存储基础架构，专为关键任务和主数据存储而设计。

但是，如果您的数据存储需求对耐久性要求不高或您的数据属于可以再生的数据（例如图像缩略图），则可以选择以较低的成本使用精简冗余存储（RRS）。 RRS提供99.99％的耐用性，与传统的Amazon S3存储相比，存储成本更低。



Data Consistency

S3是一个最终一致性的系统。 由于您的数据会自动复制到区域内的多个服务器和位置，因此数据中的变动可能需要一定时间才能同步到所有位置。 因此，在某些情况下，您在数据更新后立即读取，可能会得到过时的数据。

对于新对象进行PUT操作，这不是问题——在这种情况下，S3提供了read-afterwrite一致性。 但是，对于现有对象进行PUT（覆盖现有的key）或者删除对象，Amazon S3提供了最终一致性。

最终的一致性意味着如果您将新数据PUT到现有对象，后续GET可能会返回旧数据。 同样，如果删除对象，该对象的后续GET仍可能会读取到已删除的对象。 在所有情况下，对单个key的更新都是原子的 - 对于最终一致的读取，您将获得新数据或旧数据，但绝不会出现不一致的混合数据。



## Access Control

默认情况下，S3是足够安全的; 在S3中创建存储桶或对象时，只有您拥有访问权限。 为了能够为其他人提供受控访问，S3提供了粗粒度访问控制（Amazon S3访问控制列表\[ACL\]）和细粒度访问控制（Amazon S3存储桶策略，AWS身份和访问管理\[IAM\] 策略和查询字符串身份验证）。

S3 ACL允许您在对象或存储桶级别授予某些粗粒度权限：READ，WRITE或FULL-CONTROL。 ACL是传统的访问控制机制——在没有IAM之前。 现今的ACL适用少量场景，例如启用存储桶日志记录或使托管静态网站的对外只读开放。

存储桶策略是S3推荐的访问控制机制，它可提供更精细的控制。 Amazon S3存储桶策略与IAM策略非常相似，这些策略将在第6章“AWS身份和访问管理（IAM）”中进行讨论，但略有不同之处在于：

	• 它们与存储区资源相关联，而不是与IAM主体相关联。

	• 它们包括对策略中IAM主体的明确引用。 此主体可以与不同的AWS账户关联，因此Amazon S3存储桶策略允许您为Amazon S3资源分配跨账户访问权限。



使用S3存储桶策略，您可以指定谁可以访问存储桶，从何处（通过\[CIDR\]块或IP地址）以及在一天中的什么时间访问。

最后，IAM策略可以直接与授予Amazon S3存储桶访问权限的IAM主体相关联，就像它可以授予任意AWS服务和资源访问权限一样。 显然，您只能将IAM策略分配给您控制的AWS账户主体。



## Static Website Hosting

S3典型的应用场景是托管静态网站。许多网站，特别是一些小型网站，不需要web服务，不需要服务端语言支持。静态网站的特点是快，扩展性高，且比动态网站更为安全。如果您使用S3托管您的静态网站，你可以享受S3的安全，持久和可用性。

由于每个S3对象都有一个URL，因此把网站转换入存储桶相对简单，您只需为网站托管和配置一个存储桶，然后将静态网站的内容上传到存储桶。

为静态网站托管配置S3存储桶步骤：

1.创建一个与所需网站主机名同名的存储桶。

2.将静态文件上传到存储桶。

3.将所有文件公开（可读）。

4.为存储桶启用静态网站托管。 这包括指定索引文档和一个错误文件。

5.该网站现在将在S3网站上提供：&lt;桶名&gt;.S3-网站 - &lt;AWS区域&gt;.amazonaws.com。

6.使用DNS CNAME在您自己的域中为网站创建友好的DNS名称，或使用Route53来为网站URL指定别名。

7.网站将以您的域名开放。





